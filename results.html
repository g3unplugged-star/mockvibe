<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MockVibe Result & Analysis</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KNC6D3BBXX"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-KNC6D3BBXX');
</script>

<style>
body{margin:0;font-family:Inter;background:#f8fafc}
.header{background:#1e40af;color:#fff;padding:20px;text-align:center}
.container{max-width:1100px;margin:auto;padding:20px}
.card{background:#fff;border-radius:12px;padding:25px;margin-bottom:20px}
.score-box{text-align:center}
.score{font-size:3rem;font-weight:700;color:#2563eb}
.badge{display:inline-block;padding:6px 14px;border-radius:20px;font-weight:600;margin-top:10px}
.good{background:#d1fae5;color:#065f46}
.avg{background:#fef3c7;color:#92400e}
.poor{background:#fee2e2;color:#991b1b}
.analytics{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
.stat{background:#f1f5f9;border-radius:10px;padding:15px;text-align:center}
.stat strong{font-size:1.4rem}
.solution{border-left:4px solid #2563eb;padding:15px;margin-bottom:15px}
.correct{color:#10b981;font-weight:600}
.wrong{color:#ef4444;font-weight:600}
.btn{padding:12px 20px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
.btn-primary{background:#2563eb;color:#fff}
.btn-outline{background:#fff;border:2px solid #2563eb;color:#2563eb}
.actions{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}
</style>
</head>

<body>

<div class="header">
  <h1>ðŸ“Š MockVibe Test Analysis</h1>
  <p>Performance Breakdown & Detailed Solutions</p>
</div>

<div class="container">

  <!-- SCORE SUMMARY -->
  <div class="card score-box">
    <div class="score" id="score"></div>
    <div id="performanceBadge"></div>
    <p><strong id="examInfo"></strong></p>
  </div>

  <!-- ANALYTICS -->
  <div class="card">
    <h2>ðŸ“ˆ Performance Analytics</h2>
    <div class="analytics">
      <div class="stat">
        <strong id="correct"></strong><br>Correct
      </div>
      <div class="stat">
        <strong id="wrong"></strong><br>Wrong
      </div>
      <div class="stat">
        <strong id="accuracy"></strong><br>Accuracy
      </div>
      <div class="stat">
        <strong id="rank"></strong><br>Predicted Rank
      </div>
    </div>
  </div>

  <!-- SOLUTIONS -->
  <div class="card">
    <h2>ðŸ“˜ Detailed Solutions</h2>
    <div id="solutions"></div>
  </div>

  <!-- ACTIONS -->
  <div class="card actions">
    <button class="btn btn-primary" onclick="retakeTest()">
      <i class="fas fa-redo"></i> Retake Test
    </button>
    <button class="btn btn-outline" onclick="goHome()">
      <i class="fas fa-home"></i> Home
    </button>
    <button class="btn btn-outline" onclick="shareResult()">
      <i class="fas fa-share-alt"></i> Share Score
    </button>
  </div>

</div>

<script>
/* ================= LOAD RESULT ================= */
const result = JSON.parse(localStorage.getItem('mockvibe_result'));
if(!result){location.href='index.html';}

const {exam,section,score,total,answers} = result;
const accuracy = Math.round((score/total)*100);

/* ================= DISPLAY SCORE ================= */
document.getElementById('score').innerText = `${score} / ${total}`;
document.getElementById('examInfo').innerText =
`${exam.toUpperCase()} â€“ ${section.toUpperCase()}`;

let badgeHTML='';
if(accuracy>=80) badgeHTML='<span class="badge good">Excellent</span>';
else if(accuracy>=50) badgeHTML='<span class="badge avg">Average</span>';
else badgeHTML='<span class="badge poor">Needs Improvement</span>';
document.getElementById('performanceBadge').innerHTML=badgeHTML;

/* ================= ANALYTICS ================= */
document.getElementById('correct').innerText = score;
document.getElementById('wrong').innerText = total-score;
document.getElementById('accuracy').innerText = accuracy+'%';
document.getElementById('rank').innerText =
accuracy>=80?'Top 10%':accuracy>=50?'Top 35%':'Below Average';

/* ================= FETCH QUESTIONS ================= */
fetch(`data/questions/${exam}.json`)
.then(res=>res.json())
.then(data=>{
  const qs=data.questions.filter(q=>q.section===section).slice(0,total);
  const sol=document.getElementById('solutions');

  qs.forEach((q,i)=>{
    const userAns = answers[q.id];
    const isCorrect = userAns === q.answer;

    const div=document.createElement('div');
    div.className='solution';
    div.innerHTML=`
      <p><strong>Q${i+1}. ${q.question}</strong></p>
      <p>Your Answer: 
        <span class="${isCorrect?'correct':'wrong'}">
          ${userAns!=null?q.options[userAns]:'Not Attempted'}
        </span>
      </p>
      <p>Correct Answer: 
        <span class="correct">${q.options[q.answer]}</span>
      </p>
      <p><em>Solution:</em> ${q.solution}</p>
    `;
    sol.appendChild(div);
  });

  gtag('event','view_result',{
    exam,section,score,accuracy
  });
});

/* ================= ACTIONS ================= */
function retakeTest(){
  location.href=`test.html?exam=${exam}&section=${section}`;
}
function goHome(){ location.href='index.html'; }
function shareResult(){
  const text=`I scored ${score}/${total} in ${exam.toUpperCase()} on MockVibe!`;
  if(navigator.share){
    navigator.share({title:'MockVibe Result',text,url:location.origin});
  } else {
    alert(text);
  }
}
</script>

</body>
</html>
