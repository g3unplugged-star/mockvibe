<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>MockVibe Test</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600&display=swap" rel="stylesheet">

<style>
body{
  font-family:Inter;
  background:#f8fafc;
  margin:0;
  padding:0;
}
header{
  background:#2563eb;
  color:#fff;
  padding:20px;
  text-align:center;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.question-box{
  background:#fff;
  border-radius:12px;
  padding:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.05);
}
.question-count{
  color:#64748b;
  font-size:.9rem;
}
.question{
  font-size:1.2rem;
  margin:15px 0;
}
.options label{
  display:block;
  padding:10px;
  margin:8px 0;
  border:1px solid #e5e7eb;
  border-radius:8px;
  cursor:pointer;
}
.options input{margin-right:10px}
.actions{
  margin-top:20px;
  display:flex;
  justify-content:space-between;
}
button{
  padding:12px 20px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}
.next{background:#2563eb;color:#fff}
.submit{background:#16a34a;color:#fff}
.timer{
  font-weight:600;
}
</style>
</head>

<body>

<header>
<h2 id="testTitle">MockVibe Test</h2>
<p class="timer">Time Left: <span id="time">00:00</span></p>
</header>

<div class="container">
<div class="question-box">

<div class="question-count" id="qCount"></div>
<div class="question" id="question"></div>

<div class="options" id="options"></div>

<div class="actions">
<button class="next" onclick="nextQuestion()">Next</button>
<button class="submit" onclick="submitTest()">Submit</button>
</div>

</div>
</div>

<script>
const params = new URLSearchParams(location.search);
const exam = params.get('exam');
const section = params.get('section');
const year = params.get('year');
const mode = params.get('mode');

let file = '';
let questions = [];
let current = 0;
let answers = [];
let timeLeft = 1800; // 30 minutes default

// Decide file
if (mode === 'pyq') {
  file = `data/questions/${exam}/pyq-${year}.json`;
}
else if (mode === 'model') {
  file = `data/questions/${exam}/model-${year}.json`;
}
else {
  file = `data/questions/${exam}/${section}.json`;
}

// Load JSON
fetch(file)
.then(r => r.json())
.then(data => {

  if (data.questions) {
    questions = data.questions;
    document.getElementById('testTitle').textContent =
      `${exam.toUpperCase()} – ${section.toUpperCase()} Practice`;
  } else {
    questions = data.sections[section];
    document.getElementById('testTitle').textContent =
      `${exam.toUpperCase()} ${year} ${mode === 'model' ? 'Model' : 'PYQ'}`;
  }

  answers = new Array(questions.length).fill(null);
  startTimer();
  render();
})
.catch(() => {
  document.body.innerHTML = '<h2 style="text-align:center">❌ Test data not found</h2>';
});

function render(){
  const q = questions[current];
  document.getElementById('qCount').textContent =
    `Question ${current + 1} of ${questions.length}`;
  document.getElementById('question').textContent = q.question;

  const box = document.getElementById('options');
  box.innerHTML = '';

  q.options.forEach((opt,i)=>{
    const label = document.createElement('label');
    label.innerHTML =
      `<input type="radio" name="opt" ${answers[current]===i?'checked':''}
       onclick="answers[${current}]=${i}">
       ${opt}`;
    box.appendChild(label);
  });
}

function nextQuestion(){
  if(current < questions.length - 1){
    current++;
    render();
  }
}

function submitTest(){
  localStorage.setItem('mockvibe_result', JSON.stringify({
    exam, section, year, mode, questions, answers
  }));
  location.href = 'result.html';
}

function startTimer(){
  const t = document.getElementById('time');
  setInterval(()=>{
    timeLeft--;
    const m = String(Math.floor(timeLeft/60)).padStart(2,'0');
    const s = String(timeLeft%60).padStart(2,'0');
    t.textContent = `${m}:${s}`;
    if(timeLeft<=0) submitTest();
  },1000);
}
</script>

</body>
</html>
